#
# This file is distributed under the MIT License. See LICENSE.md for details.
#

Component: revng
Branches:
  - From: Isolate
    Steps:
      - Name: EnforceABI
        Pipes:
          - Type: LLVMPipe
            UsedContainers: [module.ll]
            Passes:
              - drop-root
              - enforce-abi
              - strip-debug-info-from-helpers
              # Note: we're running promote-csvs twice: it is important to run
              #       it before inline-helpers so that mem2reg can constant
              #       propagate helper arguments that are constant. This enables
              #       us to inline less code, in particular for helpers such as
              #       `cc_compute_c` and `cc_compute_all`.
              - promote-csvs
              - mem2reg
              - inline-helpers
              - attach-debug-info
              - promote-csvs
              - remove-exceptional-functions

        Artifacts:
          Container: module.ll
          Kind: CSVsPromoted
          SingleTargetFilename: module_abienforced.ll
